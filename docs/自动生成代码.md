# openapi-ts-request 使用说明

## 一、使用步骤

1. 在项目根目录创建或编辑 `openapi-ts-request.config.ts` 配置文件。
2. 将接口文档 URL 填入 `schemaPath` 字段。
3. 执行命令生成代码：

```bash
npm run openapi-ts-request
```

---

## 二、配置示例

```ts
import type { GenerateServiceProps } from 'openapi-ts-request'

export default [
  {
    schemaPath: 'http://petstore.swagger.io/v2/swagger.json',
    serversPath: './src/service/app',
    requestLibPath: `import request from '@/utils/request';\n import { CustomRequestOptions } from '@/interceptors/request';`,
    requestOptionsType: 'CustomRequestOptions',
    isGenReactQuery: true,
    reactQueryMode: 'vue',
    isGenJavaScript: false,
  },
] as GenerateServiceProps[]
```

---

## 三、生成内容说明

### 1. TypeScript 类型定义

- 生成路径：`src/service/app/types.ts`
- 使用方式：

```ts
import { type Category } from '@/service/app'

const category: Category = {
  id: 1,
  name: '张三',
}
```

---

### 2. uni.request 客户端代码

- 生成路径：`src/service/app/`
- 使用方式：

```ts
import { getPetById } from '@/service/app'

onShow(async () => {
  const res = await getPetById({ id: 1 })
  console.log('res: ', res)
})
```

---

### 3. vue-query 支持

- 生成路径：`src/service/app/moduleName.vuequery.ts`
- 使用方式：

```ts
import { useQuery } from '@tanstack/vue-query'
import { findPetsByStatusQueryOptions, usePlaceOrderMutation } from '@/service/app'
```

#### GET 请求（useQuery）

```ts
const { data, error, isLoading, refetch } = useQuery(
  findPetsByStatusQueryOptions({ params: { status: ['available'] } }),
)
```

#### GET 请求（带条件）

```ts
const { data, error, isLoading, refetch } = useQuery({
  ...findPetsByStatusQueryOptions({ params: { status: ['available'] } }),
  enabled: !!token,
})
```

#### POST/DELETE/PATCH 请求（useMutation）

```ts
export function usePlaceOrderMutation(options?: {
  onSuccess?: (value?: API.Order) => void
  onError?: (error?: DefaultError) => void
}) {
  const { onSuccess, onError } = options || {}

  const response = useMutation({
    mutationFn: apis.placeOrder,
    onSuccess(data: API.Order) {
      onSuccess?.(data)
    },
    onError(error) {
      onError?.(error)
    },
  })

  return response
}
```

#### 提交请求

```ts
const { mutate, isPending } = usePlaceOrderMutation({
  onSuccess: (data) => {
    console.log('success data: ', data)
  },
})

mutate({
  body: {
    status: 'placed',
    complete: true,
  },
})
```
